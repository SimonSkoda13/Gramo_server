"use strict";
/*
 * Copyright (c) 2021-2021.
 * Author Peter Placzek (tada5hi)
 * For the full copyright and license information,
 * view the LICENSE file that was distributed with this source code.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseQuery = void 0;
const type_1 = require("../type");
const parameter_1 = require("./parameter");
function parseQuery(input, options) {
    var _a, _b, _c, _d, _e;
    options !== null && options !== void 0 ? options : (options = {});
    const output = {};
    const nonEnabled = Object.keys(options).length === 0;
    let relations;
    if (!!options[type_1.Parameter.RELATIONS] || nonEnabled) {
        relations = (0, parameter_1.parseQueryParameter)(type_1.Parameter.RELATIONS, (_a = input[type_1.Parameter.RELATIONS]) !== null && _a !== void 0 ? _a : input[type_1.URLParameter.RELATIONS], options[type_1.Parameter.RELATIONS]);
        output[type_1.Parameter.RELATIONS] = relations;
    }
    const keys = [
        type_1.Parameter.FIELDS,
        type_1.Parameter.FILTERS,
        type_1.Parameter.PAGINATION,
        type_1.Parameter.SORT
    ];
    for (let i = 0; i < keys.length; i++) {
        const enabled = !!options[keys[i]] ||
            nonEnabled;
        if (!enabled)
            continue;
        const key = keys[i];
        switch (key) {
            case type_1.Parameter.FIELDS:
                output[type_1.Parameter.FIELDS] = (0, parameter_1.parseQueryParameter)(keys[i], (_b = input[type_1.Parameter.FIELDS]) !== null && _b !== void 0 ? _b : input[type_1.URLParameter.FIELDS], options[type_1.Parameter.FIELDS], relations);
                break;
            case type_1.Parameter.FILTERS:
                output[type_1.Parameter.FILTERS] = (0, parameter_1.parseQueryParameter)(keys[i], (_c = input[type_1.Parameter.FILTERS]) !== null && _c !== void 0 ? _c : input[type_1.URLParameter.FILTERS], options[type_1.Parameter.FILTERS], relations);
                break;
            case type_1.Parameter.PAGINATION:
                output[type_1.Parameter.PAGINATION] = (0, parameter_1.parseQueryParameter)(keys[i], (_d = input[type_1.Parameter.PAGINATION]) !== null && _d !== void 0 ? _d : input[type_1.URLParameter.PAGINATION], options[type_1.Parameter.PAGINATION], relations);
                break;
            case type_1.Parameter.SORT:
                output[type_1.Parameter.SORT] = (0, parameter_1.parseQueryParameter)(keys[i], (_e = input[type_1.Parameter.SORT]) !== null && _e !== void 0 ? _e : input[type_1.URLParameter.SORT], options[type_1.Parameter.SORT], relations);
                break;
        }
    }
    return output;
}
exports.parseQuery = parseQuery;
//# sourceMappingURL=module.js.map